require(testthat)
require(picante)
require(pez)
data(phylocom)

context("traitgrams")

test_that("FPDist", {
    traits <- comparative.comm(phylocom$phy, phylocom$sample, phylocom$traits, warn=FALSE)
    simple <- FPDist(traits)
    expect_that(FPDist(traits, 1, 1), equals(cophenetic(traits$phy)/max(cophenetic(traits$phy))))
    expect_that(FPDist(traits, 0, 1), equals(as.matrix(dist(traits$traits)) / max(as.matrix(dist(traits$traits)))))
})

#Hard to test this, because I don't really know what it's doing!
test_that("ConDivSim", {
    traits <- comparative.comm(phylocom$phy, phylocom$sample, phylocom$traits, warn=FALSE)
    set.seed(123)
    expect_that(ConDivSim(traits, "traits"), equals(structure(c(7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 2.26151944279941, 
2.30552801045639, 2.2446476671691, 2.25827778624457, 2.2634161218341, 
2.27269578517812, 2.28231578067609, 2.29080674303854, 2.2767477990558, 
2.28196005777693, 2.27323482084336, 1.66730192206562, 1.88161682195176, 
1.87915747102665, 1.91811318373618, 1.88106448264201, 1.87446236212754, 
2.01177060820542, 2.01789291221002, 2.05923407828967, 2.09930887197547, 
2.06245783287281, 1.83777375771322, 1.94367278776002, 1.92114902115703, 
1.97538959296289, 1.97614414525011, 2.02071902499968, 2.07337027310233, 
2.08069453735696, 2.11537752624116, 2.10900631391915, 2.10319481219397, 
1.8958781642922, 1.98645106807131, 1.92902009185463, 2.01592562834423, 
2.03603182496099, 2.03952643969731, 2.10798660568722, 2.11926362381, 
2.13761302128414, 2.13508379029126, 2.16871426716387, 2.13891353806674, 
2.20372425325958, 2.13469387838393, 2.16040280106621, 2.18233254110604, 
2.20212984480635, 2.19002332108987, 2.22641905879263, 2.21981659657836, 
2.22531825799757, 2.22715961107251, 2.39563170728168, 2.41966036151241, 
2.37107992469661, 2.37506890491179, 2.3615561290597, 2.34996129608268, 
2.36725345749088, 2.35689720612386, 2.33382538306486, 2.34320500645474, 
2.31446881734887, 2.60069601500679, 2.63131936422257, 2.54839356629242, 
2.50083793299583, 2.47718106097963, 2.47125399439838, 2.47469143313703, 
2.43790482038196, 2.40222284051994, 2.39974698219675, 2.39547290548354, 
2.72167612962939, 2.66824883691769, 2.5867211175327, 2.54333460040536, 
2.51567106384691, 2.53378677611286, 2.48385356636969, 2.46711626056857, 
2.43209975600498, 2.43467576815094, 2.41202663007731, 2.76704734979577, 
2.74899098190567, 2.64328859189854, 2.57785020330388, 2.53958976575122, 
2.55765612941387, 2.51186333002678, 2.55469713821859, 2.45100864309116, 
2.4641949761217, 2.45331785020173, 0.218718076080313, 0.184961262467011, 
0.179820381585158, 0.153844638711671, 0.141575500745962, 0.134924883809876, 
0.115604294149042, 0.100827979618171, 0.086342918910899, 0.0860121782133422, 
0.0745152231514535), .Dim = c(11L, 11L), .Dimnames = list(c("1", 
"2", "3", "4", "5", "6", "7", "8", "9", "10", "11"), c("SpRich", 
"ExpMeanMPD", "ExpQ0.005MPD", "ExpQ0.025MPD", "ExpQ0.05MPD", 
"ExpQ0.25MPD", "ExpQ0.75MPD", "ExpQ0.95MPD", "ExpQ0.975MPD", 
"ExpQ0.995MPD", "ExpSdMPD")))))
})

#Hard to test this, because I don't really know what it's doing!
test_that("fpcomSims", {
    set.seed(123)
    expect_that(fpcomSims(10,20), equals(structure(list(comm = structure(c(1L, 0L, 1L, 1L, 0L, 0L, 1L, 
0L, 1L, 1L, 0L, 1L, 1L, 1L, 0L, 1L, 1L, 0L, 1L, 1L, 1L, 0L, 1L, 
0L, 0L, 1L, 1L, 0L, 0L, 1L, 1L, 1L, 1L, 1L, 0L, 1L, 1L, 1L, 1L, 
1L, 1L, 0L, 1L, 0L, 0L, 1L, 1L, 0L, 0L, 1L, 1L, 1L, 1L, 1L, 0L, 
1L, 1L, 0L, 0L, 0L, 1L, 0L, 1L, 1L, 0L, 1L, 0L, 0L, 0L, 1L, 0L, 
0L, 1L, 1L, 1L, 1L, 1L, 0L, 0L, 1L, 0L, 0L, 1L, 0L, 0L, 0L, 0L, 
0L, 0L, 1L, 1L, 0L, 1L, 0L, 0L, 1L, 1L, 0L, 0L, 0L, 1L, 0L, 0L, 
0L, 0L, 1L, 0L, 0L, 1L, 1L, 1L, 0L, 1L, 1L, 0L, 1L, 0L, 0L, 0L, 
1L, 0L, 0L, 1L, 0L, 1L, 1L, 0L, 0L, 0L, 1L, 0L, 0L, 1L, 1L, 1L, 
1L, 0L, 0L, 0L, 0L, 0L, 1L, 1L, 1L, 0L, 0L, 0L, 0L, 0L, 1L, 0L, 
0L, 0L, 1L, 1L, 1L, 1L, 0L, 0L, 0L, 0L, 0L, 0L, 0L, 1L, 0L, 0L, 
0L, 0L, 1L, 0L, 1L, 1L, 1L, 1L, 0L, 1L, 0L, 0L, 0L, 1L, 0L, 1L, 
1L, 0L, 1L, 1L, 0L, 0L, 1L, 1L, 0L, 0L, 1L, 0L, 1L, 0L, 0L, 0L, 
1L), .Dim = c(10L, 20L), .Dimnames = list(c("site01", "site02", 
"site03", "site04", "site05", "site06", "site07", "site08", "site09", 
"site10"), c("sp01", "sp02", "sp03", "sp04", "sp05", "sp06", 
"sp07", "sp08", "sp09", "sp10", "sp11", "sp12", "sp13", "sp14", 
"sp15", "sp16", "sp17", "sp18", "sp19", "sp20"))), probs = structure(c(0.514116793874685, 
0.488514637521484, 0.604792783528683, 0.494412806175538, 0.462071020474207, 
0.682904714682341, 0.54059424560316, 0.305948973995588, 0.477565727988663, 
0.42981295046027, 0.445969135116628, 0.447194916651399, 0.790872463099271, 
0.491263317349182, 0.450509630795495, 0.87087135225643, 0.604201888211432, 
0.136674419526661, 0.379246555354592, 0.339976200631745, 0.435884733915436, 
0.442532618032684, 0.805342898280294, 0.49125570659856, 0.451758034688655, 
0.881312485785066, 0.609652135313213, 0.127885026418151, 0.368147978991459, 
0.333251437863763, 0.492933120633147, 0.456772497686857, 0.783338105987594, 
0.487536868065459, 0.420827722558717, 0.887937578042877, 0.610218132346213, 
0.107971599784124, 0.406515705255638, 0.322472650005037, 0.517789819430171, 
0.450002629009704, 0.835550457398392, 0.481869507025913, 0.382465055131721, 
0.939964461436114, 0.643411584660634, 0.0538752241793118, 0.396288171861837, 
0.269174912971547, 0.330813308628775, 0.412360533652121, 0.854350242198586, 
0.497606571225832, 0.507050725018252, 0.882979320265744, 0.615844058155733, 
0.155396066454323, 0.293299126809329, 0.343071995295406, 0.212434447759373, 
0.386711700480711, 0.855974808746517, 0.510910594035482, 0.61076966990973, 
0.783911400583055, 0.585298358932198, 0.35201353063795, 0.229795255091553, 
0.42104528226633, 0.225828573599399, 0.388894211052307, 0.860070296521923, 
0.508831953199383, 0.595473960539487, 0.808625123967765, 0.592307284372341, 
0.307981704369614, 0.235629899434603, 0.405616067437886, 0.303270122889017, 
0.428066753438243, 0.751851435358752, 0.507159277968173, 0.57249403178761, 
0.685804639134284, 0.552468102637686, 0.413649740354903, 0.318363464688903, 
0.452966381647783, 0.261328774505116, 0.409857308022566, 0.802916772920278, 
0.508741123632151, 0.588938421826473, 0.7325540809522, 0.567132828179648, 
0.384793359321747, 0.277550101203138, 0.438456968714573, 0.588729419721762, 
0.494396533137566, 0.65621061757276, 0.485460683218344, 0.395854229191322, 
0.818343292559379, 0.576085785428655, 0.149031177081866, 0.502643845097088, 
0.358460056928209, 0.443763496968907, 0.437045559911901, 0.836491797857875, 
0.488384475798073, 0.43239351925151, 0.916251268897484, 0.628990017296294, 
0.0882272577959367, 0.358256681459279, 0.302236520576783, 0.260947870830776, 
0.389823735663706, 0.884845637240958, 0.502321866829616, 0.548219835395613, 
0.885381583058998, 0.621063369342263, 0.177465757842234, 0.242871317373417, 
0.349629692616814, 0.290973566889332, 0.400700561679099, 0.868894240482252, 
0.50049254831143, 0.531663120293791, 0.879665526094228, 0.616457639744878, 
0.17380544094983, 0.266160654477653, 0.350344679518699, 0.299702110835736, 
0.406892990781958, 0.852019860073361, 0.500995243544661, 0.533568446145228, 
0.859486997890034, 0.606814354222063, 0.198039292924903, 0.278514468438558, 
0.36401320727085, 0.314827799339109, 0.413659106532367, 0.836352503100135, 
0.500632823184745, 0.528963478632036, 0.846088596452313, 0.600437372917371, 
0.20955937794155, 0.293203696438716, 0.37111802811573, 0.380950647767009, 
0.424115446335264, 0.844318153617382, 0.493547566515826, 0.473768875862895, 
0.897063114068985, 0.62056420473002, 0.123438560300316, 0.323160875860634, 
0.326100936147866, 0.363683610020121, 0.426383665096965, 0.820827541090457, 
0.49690569110845, 0.497865609886897, 0.857742815958164, 0.602568370940398, 
0.176320765364657, 0.324885733127534, 0.357788051779009, 0.388268038642843, 
0.432007741293569, 0.815432533164365, 0.494949998589207, 0.481848674548882, 
0.866192072488819, 0.604965853869745, 0.15821270999357, 0.339684728222475, 
0.34927722304331, 0.402090626839764, 0.447034971199604, 0.74966886428615, 
0.497628134049889, 0.497338207977633, 0.786301908932445, 0.574766197089117, 
0.245534924636823, 0.371995451109772, 0.395283193372222), "`scaled:center`" = -5.89675877571416e-17, "`scaled:scale`" = 0.938683159481029, .Dim = c(10L, 
20L), .Dimnames = list(c("site01", "site02", "site03", "site04", 
"site05", "site06", "site07", "site08", "site09", "site10"), 
    c("sp01", "sp02", "sp03", "sp04", "sp05", "sp06", "sp07", 
    "sp08", "sp09", "sp10", "sp11", "sp12", "sp13", "sp14", "sp15", 
    "sp16", "sp17", "sp18", "sp19", "sp20"))), traits = structure(c(0.423543001466602, 
0.625430648156043, 0.621053472442271, 0.92628823136441, 1.36138811608072, 
0.0933488828264045, -0.972234774959001, -0.807683070681105, -0.634522296707906, 
-0.777584979247685, 1.12802172379166, 0.839147514648194, -0.299003909964364, 
-0.144392376580405, -0.176814081875075, -0.141193538975731, 0.422569448022619, 
0.163161274345467, 0.321697814362159, 0.128939284545999), .Names = c("sp01", 
"sp02", "sp03", "sp04", "sp05", "sp06", "sp07", "sp08", "sp09", 
"sp10", "sp11", "sp12", "sp13", "sp14", "sp15", "sp16", "sp17", 
"sp18", "sp19", "sp20"), unknown = c(0.462967607205738, 1.53052603406943, 
1.63943748107142, 1.44048257297308, 1.79926013326838, 2.12342536500716, 
2.26601316484051, 2.2870032786801, 1.41294388725324, 1.78723527376438, 
0.645779441225073, 1.8696710167511, 2.49586909783133, 2.29900218520699, 
2.13311689975757, 1.98506461431747, 1.98964256899261, 1.81689782672167, 
1.7542884224306, 1.30804884159268)), env = structure(c(0.978215841046876, 
0.145646605833788, 0.185102027615774, -0.0943471296216706, -0.736424901383331, 
1.52040422917001, 0.27862049013351, -2.09545792567858, 0.474661950043644, 
-0.656421187160021), .Names = c("site01", "site02", "site03", 
"site04", "site05", "site06", "site07", "site08", "site09", "site10"
)), ecosysfunc = structure(c(0.156170244414359, -0.0869629366312515, 
0.870548228733471, -0.0493319426270149, -0.339557069513915, 1.62016582529748, 
0.34181445010105, -1.75002990707667, -0.161857130237661, -0.600959762459844
), .Names = c("site01", "site02", "site03", "site04", "site05", 
"site06", "site07", "site08", "site09", "site10")), tree = structure(list(
    edge = structure(c(21L, 21L, 22L, 23L, 32L, 33L, 33L, 32L, 
    35L, 35L, 23L, 25L, 30L, 30L, 39L, 39L, 25L, 36L, 36L, 22L, 
    24L, 28L, 28L, 24L, 26L, 31L, 34L, 34L, 38L, 38L, 31L, 26L, 
    27L, 29L, 29L, 37L, 37L, 27L, 1L, 22L, 23L, 32L, 33L, 2L, 
    3L, 35L, 4L, 5L, 25L, 30L, 6L, 39L, 7L, 8L, 36L, 9L, 10L, 
    24L, 28L, 11L, 12L, 26L, 31L, 34L, 13L, 38L, 14L, 15L, 16L, 
    27L, 29L, 17L, 37L, 18L, 19L, 20L), .Dim = c(38L, 2L)), edge.length = c(1.94713320905753, 
    1.12929003384912, 0.196228214073926, 0.542959804147521, 0.000407278768736863, 
    0.0782478782182186, 0.0782478782182186, 0.0319218908542197, 
    0.0467332661327358, 0.0467332661327358, 0.272034841600557, 
    0.222451365791502, 0.127128753742417, 0.119082993004637, 
    0.00804576073778002, 0.00804576073778002, 0.31622895626, 
    0.033351163273919, 0.033351163273919, 0.405335047898566, 
    0.266911306894795, 0.145596820415042, 0.145596820415042, 
    0.115640125032818, 0.209154516634204, 0.0267255255223454, 
    0.0609879601204689, 0.0450396700036361, 0.0159482901168328, 
    0.0159482901168328, 0.0877134856428143, 0.0585250348453584, 
    0.0999560863868979, 0.138386881044762, 0.113627842655099, 
    0.0247590383896633, 0.0247590383896633, 0.23834296743166), 
    tip.label = c("sp01", "sp02", "sp03", "sp04", "sp05", "sp06", 
    "sp07", "sp08", "sp09", "sp10", "sp11", "sp12", "sp13", "sp14", 
    "sp15", "sp16", "sp17", "sp18", "sp19", "sp20"), Nnode = 19L), .Names = c("edge", 
"edge.length", "tip.label", "Nnode"), class = "phylo", order = "cladewise"), 
    tuning = 0.5), .Names = c("comm", "probs", "traits", "env", 
"ecosysfunc", "tree", "tuning"), class = "fpcomSims")))
})
