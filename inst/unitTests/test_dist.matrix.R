#source ('../R/comparative.comm.R')
#source ('../R/dist.matrix.R')
require(svUnit)

require(picante)
data(phylocom)
data <- structure(list(phy = structure(list(edge = structure(c(24L, 25L,26L, 27L, 28L, 28L, 27L, 29L, 29L, 26L, 30L, 31L, 31L, 30L, 32L,32L, 25L, 33L, 34L, 35L, 35L, 34L, 36L, 36L, 33L, 37L, 38L, 38L,37L, 24L, 39L, 40L, 41L, 41L, 42L, 42L, 40L, 43L, 44L, 44L, 43L,39L, 45L, 45L, 25L, 26L, 27L, 28L, 1L, 2L, 29L, 3L, 4L, 30L,31L, 5L, 6L, 32L, 7L, 8L, 33L, 34L, 35L, 9L, 10L, 36L, 11L, 12L,37L, 38L, 13L, 14L, 15L, 39L, 40L, 41L, 16L, 42L, 17L, 18L, 43L,44L, 19L, 20L, 21L, 45L, 22L, 23L), .Dim = c(44L, 2L)), tip.label = c("sp1","sp2", "sp3", "sp4", "sp5", "sp6", "sp7", "sp8", "sp9", "sp10","sp11", "sp12", "sp13", "sp14", "sp15", "sp18", "sp19", "sp20","sp21", "sp22", "sp24", "sp26", "sp29"), Nnode = 22L, node.label = c("A","B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N","O", "Q", "R", "S", "U", "V", "W", "Y"), edge.length = c(1, 1,1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,1, 1, 1, 1, 1, 2, 1, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 2, 1, 3, 3)), .Names = c("edge", "tip.label", "Nnode", "node.label", "edge.length"), class = "phylo", order = "cladewise"), comm = structure(c(1,1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 0, 0, 0, 1, 1, 1, 0,0, 0, 1, 0, 0, 0, 1, 2, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1,0, 0, 0, 0, 0, 0, 2, 0, 1, 1, 0, 0, 2, 0, 1, 0, 0, 0, 2, 0, 0,0, 0, 0, 2, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 4, 0,0, 0, 0, 0, 2, 0, 0, 2, 2, 0, 0, 0, 0, 2, 0, 0, 0, 0, 0, 2, 0,0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 2, 0,0, 0, 2, 0, 0, 0, 0, 0, 0, 1, 0), .Dim = c(6L, 23L), .Dimnames = list(c("clump1", "clump2a", "clump2b", "clump4", "even", "random"), c("sp1", "sp2", "sp3", "sp4", "sp5", "sp6", "sp7", "sp8",    "sp9", "sp10", "sp11", "sp12", "sp13", "sp14", "sp15", "sp18",    "sp19", "sp20", "sp21", "sp22", "sp24", "sp26", "sp29"))),    traits = structure(list(traitA = c(1L, 1L, 2L, 2L, 2L, 2L,    2L, 2L, 1L, 1L, 2L, 2L, 2L, 2L, 2L, 1L, 2L, 2L, 2L, 2L, 2L,    1L, 2L), traitB = c(1L, 1L, 1L, 1L, 2L, 2L, 2L, 2L, 3L, 3L,    3L, 3L, 4L, 4L, 4L, 1L, 1L, 1L, 2L, 2L, 2L, 3L, 4L), traitC = c(1L,    2L, 3L, 4L, 1L, 2L, 3L, 4L, 1L, 2L, 3L, 4L, 1L, 2L, 3L, 2L,    3L, 4L, 1L, 2L, 4L, 2L, 1L), traitD = c(0L, 0L, 0L, 0L, 0L,    0L, 0L, 0L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L, 1L,    1L, 1L, 1L)), .Names = c("traitA", "traitB", "traitC", "traitD"), row.names = c("sp1", "sp2", "sp3", "sp4", "sp5", "sp6",    "sp7", "sp8", "sp9", "sp10", "sp11", "sp12", "sp13", "sp14",    "sp15", "sp18", "sp19", "sp20", "sp21", "sp22", "sp24", "sp26",    "sp29"), class = "data.frame"), comm.name = "phylocom$sample",    phy.name = "phylocom$phy", traits.name = "phylocom$traits",    dropped = structure(list(tips = c("sp16", "sp17", "sp23",    "sp25", "sp27", "sp28", "sp30", "sp31", "sp32"), unmatched.cols = c("sp16",    "sp23", "sp27", "sp28", "sp30", "sp31", "sp32")), .Names = c("tips",    "unmatched.cols"))), .Names = c("phy", "comm", "traits","comm.name", "phy.name", "traits.name", "dropped"), class = "comparative.comm")
comm.dist.output <- structure(c(0, 0.333333333333333, 0.4, 0.4, 0.666666666666667,0.8, 0.8, 0.8, 0.4, 0.6, 0.8, 0.833333333333333, 0.8, 1, 1, 0.6,0.8, 0.8, 0.8, 1, 1, 0.8, 0.8, 0.333333333333333, 0, 0.4, 0.4,0.666666666666667, 0.8, 0.8, 0.8, 0.666666666666667, 0.6, 0.8,0.6, 1, 0.8, 0.8, 0.6, 0.8, 0.8, 1, 0.8, 0.8, 0.8, 1, 0.4, 0.4,0, 0, 0.8, 0.666666666666667, 0.666666666666667, 0.666666666666667,0.8, 0.75, 0.666666666666667, 0.75, 1, 1, 1, 0.75, 0.666666666666667,0.666666666666667, 1, 1, 1, 1, 1, 0.4, 0.4, 0, 0, 0.8, 0.666666666666667,0.666666666666667, 0.666666666666667, 0.8, 0.75, 0.666666666666667,0.75, 1, 1, 1, 0.75, 0.666666666666667, 0.666666666666667, 1,1, 1, 1, 1, 0.666666666666667, 0.666666666666667, 0.8, 0.8, 0,0.666666666666667, 0.666666666666667, 0.666666666666667, 0.8,1, 1, 0.75, 0.666666666666667, 0.666666666666667, 0.666666666666667,1, 1, 1, 0.666666666666667, 0.666666666666667, 0.666666666666667,1, 0.666666666666667, 0.8, 0.8, 0.666666666666667, 0.666666666666667,0.666666666666667, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,1, 1, 1, 1, 0.8, 0.8, 0.666666666666667, 0.666666666666667, 0.666666666666667,0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.8, 0.8,0.666666666666667, 0.666666666666667, 0.666666666666667, 0, 0,0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.4, 0.666666666666667,0.8, 0.8, 0.8, 1, 1, 1, 0, 0.333333333333333, 0.666666666666667,0.75, 0.666666666666667, 1, 1, 0.75, 1, 1, 0.666666666666667,1, 1, 0.666666666666667, 0.666666666666667, 0.6, 0.6, 0.75, 0.75,1, 1, 1, 1, 0.333333333333333, 0, 0.5, 0.666666666666667, 1,1, 1, 0.666666666666667, 1, 1, 1, 1, 1, 0.5, 1, 0.8, 0.8, 0.666666666666667,0.666666666666667, 1, 1, 1, 1, 0.666666666666667, 0.5, 0, 0.5,1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.833333333333333, 0.6, 0.75,0.75, 0.75, 1, 1, 1, 0.75, 0.666666666666667, 0.5, 0, 1, 0.5,0.5, 1, 1, 1, 1, 0.5, 0.5, 1, 1, 0.8, 1, 1, 1, 0.666666666666667,1, 1, 1, 0.666666666666667, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0, 1,1, 1, 0, 1, 0.8, 1, 1, 0.666666666666667, 1, 1, 1, 1, 1, 1, 0.5,1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 1, 0.8, 1, 1, 0.666666666666667,1, 1, 1, 1, 1, 1, 0.5, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 0.6,0.6, 0.75, 0.75, 1, 1, 1, 1, 0.75, 0.666666666666667, 1, 1, 1,1, 1, 0, 0.5, 0.5, 1, 1, 1, 0.5, 1, 0.8, 0.8, 0.666666666666667,0.666666666666667, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.5, 0, 0,1, 1, 1, 1, 1, 0.8, 0.8, 0.666666666666667, 0.666666666666667,1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0.5, 0, 0, 1, 1, 1, 1, 1, 0.8,1, 1, 1, 0.666666666666667, 1, 1, 1, 0.666666666666667, 1, 1,1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0, 1, 0.8, 1, 1, 0.666666666666667,1, 1, 1, 1, 1, 1, 0.5, 1, 0, 0, 1, 1, 1, 1, 0, 0, 1, 1, 1, 0.8,1, 1, 0.666666666666667, 1, 1, 1, 1, 1, 1, 0.5, 1, 0, 0, 1, 1,1, 1, 0, 0, 1, 1, 0.8, 0.8, 1, 1, 1, 1, 1, 1, 0.666666666666667,0.5, 1, 1, 1, 1, 1, 0.5, 1, 1, 1, 1, 1, 0, 1, 0.8, 1, 1, 1, 0.666666666666667,1, 1, 1, 0.666666666666667, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0, 1,1, 1, 0), .Dim = c(23L, 23L), .Dimnames = list(c("1", "2", "3","4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14", "15","16", "17", "18", "19", "20", "21", "22", "23"), c("1", "2","3", "4", "5", "6", "7", "8", "9", "10", "11", "12", "13", "14","15", "16", "17", "18", "19", "20", "21", "22", "23")))
trait.dist.output <- structure(c(0, 0.894780929273979, 2.85715172143432, 3.4880482388088,2.40686957599093, 2.56781114321579, 2.99925870864792, 3.60537340068437,2.74692810883134, 2.88898718350915, 3.96344925467488, 4.43983046425704,4.08259507658297, 4.17949942824879, 4.45759062778416, 2.23993294052725,3.51851994821143, 4.04761005816072, 3.16380906859081, 3.28790521972423,4.14914256504028, 2.88898718350915, 4.08259507658297, 0.894780929273979,0, 2.40029523707353, 2.85715172143432, 2.56781114321579, 2.40686957599093,2.56781114321579, 2.99925870864792, 2.88898718350915, 2.74692810883134,3.64788037909765, 3.96344925467488, 4.17949942824879, 4.08259507658297,4.17949942824879, 2.05345237750153, 3.15881051849974, 3.51851994821143,3.28790521972423, 3.16380906859081, 3.63486168486052, 2.74692810883134,4.17949942824879, 2.85715172143432, 2.40029523707353, 0, 0.894780929273979,2.00867331531907, 1.27783792145079, 0.912270158508577, 1.27783792145079,3.96344925467488, 3.64788037909765, 2.74692810883134, 2.88898718350915,3.8612601429046, 3.53658467408974, 3.42151987362547, 3.15881051849974,2.05345237750153, 2.23993294052725, 2.87253114070876, 2.41858148925446,2.41858148925446, 3.64788037909765, 3.8612601429046, 3.4880482388088,2.85715172143432, 0.894780929273979, 0, 2.83512487284721, 2.00867331531907,1.27783792145079, 0.912270158508577, 4.43983046425704, 3.96344925467488,2.88898718350915, 2.74692810883134, 4.3488497845, 3.8612601429046,3.53658467408974, 3.51851994821143, 2.23993294052725, 2.05345237750153,3.50065703994316, 2.87253114070876, 2.24697652608387, 3.96344925467488,4.3488497845, 2.40686957599093, 2.56781114321579, 2.00867331531907,2.83512487284721, 0, 0.894780929273979, 1.78956185854796, 2.68434278782194,3.16380906859081, 3.28790521972423, 2.87253114070876, 3.50065703994316,2.74692810883134, 2.88898718350915, 3.27843646890669, 3.28790521972423,2.87253114070876, 3.50065703994316, 2.05345237750153, 2.23993294052725,3.37969863585473, 3.28790521972423, 2.74692810883134, 2.56781114321579,2.40686957599093, 1.27783792145079, 2.00867331531907, 0.894780929273979,0, 0.894780929273979, 1.78956185854796, 3.28790521972423, 3.16380906859081,2.41858148925446, 2.87253114070876, 2.88898718350915, 2.74692810883134,2.88898718350915, 3.16380906859081, 2.41858148925446, 2.87253114070876,2.23993294052725, 2.05345237750153, 2.72382053598182, 3.16380906859081,2.88898718350915, 2.99925870864792, 2.56781114321579, 0.912270158508577,1.27783792145079, 1.78956185854796, 0.894780929273979, 0, 0.894780929273979,3.63486168486052, 3.28790521972423, 2.24697652608387, 2.41858148925446,3.27843646890669, 2.88898718350915, 2.74692810883134, 3.28790521972423,2.24697652608387, 2.41858148925446, 2.72382053598182, 2.23993294052725,2.23993294052725, 3.28790521972423, 3.27843646890669, 3.60537340068437,2.99925870864792, 1.27783792145079, 0.912270158508577, 2.68434278782194,1.78956185854796, 0.894780929273979, 0, 4.14914256504028, 3.63486168486052,2.41858148925446, 2.24697652608387, 3.84074344855516, 3.27843646890669,2.88898718350915, 3.63486168486052, 2.41858148925446, 2.24697652608387,3.37969863585473, 2.72382053598182, 2.05345237750153, 3.63486168486052,3.84074344855516, 2.74692810883134, 2.88898718350915, 3.96344925467488,4.43983046425704, 3.16380906859081, 3.28790521972423, 3.63486168486052,4.14914256504028, 0, 0.894780929273979, 2.85715172143432, 3.4880482388088,2.40686957599093, 2.56781114321579, 2.99925870864792, 2.03213687526541,3.39002408954806, 3.93642323495304, 2.40686957599093, 2.56781114321579,3.60537340068437, 0.894780929273979, 2.40686957599093, 2.88898718350915,2.74692810883134, 3.64788037909765, 3.96344925467488, 3.28790521972423,3.16380906859081, 3.28790521972423, 3.63486168486052, 0.894780929273979,0, 2.40029523707353, 2.85715172143432, 2.56781114321579, 2.40686957599093,2.56781114321579, 1.82454031701715, 3.01502314975175, 3.39002408954806,2.56781114321579, 2.40686957599093, 2.99925870864792, 0, 2.56781114321579,3.96344925467488, 3.64788037909765, 2.74692810883134, 2.88898718350915,2.87253114070876, 2.41858148925446, 2.24697652608387, 2.41858148925446,2.85715172143432, 2.40029523707353, 0, 0.894780929273979, 2.00867331531907,1.27783792145079, 0.912270158508577, 3.01502314975175, 1.82454031701715,2.03213687526541, 2.00867331531907, 1.27783792145079, 1.27783792145079,2.40029523707353, 2.00867331531907, 4.43983046425704, 3.96344925467488,2.88898718350915, 2.74692810883134, 3.50065703994316, 2.87253114070876,2.41858148925446, 2.24697652608387, 3.4880482388088, 2.85715172143432,0.894780929273979, 0, 2.83512487284721, 2.00867331531907, 1.27783792145079,3.39002408954806, 2.03213687526541, 1.82454031701715, 2.83512487284721,2.00867331531907, 0.912270158508576, 2.85715172143432, 2.83512487284721,4.08259507658297, 4.17949942824879, 3.8612601429046, 4.3488497845,2.74692810883134, 2.88898718350915, 3.27843646890669, 3.84074344855516,2.40686957599093, 2.56781114321579, 2.00867331531907, 2.83512487284721,0, 0.894780929273979, 1.78956185854796, 3.6402676830235, 3.26996379559728,3.83351376435236, 1.82454031701715, 2.03213687526541, 3.24571156619819,2.56781114321579, 0, 4.17949942824879, 4.08259507658297, 3.53658467408974,3.8612601429046, 2.88898718350915, 2.74692810883134, 2.88898718350915,3.27843646890669, 2.56781114321579, 2.40686957599093, 1.27783792145079,2.00867331531907, 0.894780929273979, 0, 0.894780929273979, 3.52858553710589,2.87936876595197, 3.26996379559728, 2.03213687526541, 1.82454031701715,2.55567584290157, 2.40686957599093, 0.894780929273979, 4.45759062778416,4.17949942824879, 3.42151987362547, 3.53658467408974, 3.27843646890669,2.88898718350915, 2.74692810883134, 2.88898718350915, 2.99925870864792,2.56781114321579, 0.912270158508577, 1.27783792145079, 1.78956185854796,0.894780929273979, 0, 3.6402676830235, 2.73681047552573, 2.87936876595197,2.55567584290157, 2.03213687526541, 2.03213687526541, 2.56781114321579,1.78956185854796, 2.23993294052725, 2.05345237750153, 3.15881051849974,3.51851994821143, 3.28790521972423, 3.16380906859081, 3.28790521972423,3.63486168486052, 2.03213687526541, 1.82454031701715, 3.01502314975175,3.39002408954806, 3.6402676830235, 3.52858553710589, 3.6402676830235,0, 2.40029523707353, 2.85715172143432, 2.56781114321579, 2.40686957599093,2.99925870864792, 1.82454031701715, 3.6402676830235, 3.51851994821143,3.15881051849974, 2.05345237750153, 2.23993294052725, 2.87253114070876,2.41858148925446, 2.24697652608387, 2.41858148925446, 3.39002408954806,3.01502314975175, 1.82454031701715, 2.03213687526541, 3.26996379559728,2.87936876595197, 2.73681047552573, 2.40029523707353, 0, 0.894780929273979,2.00867331531907, 1.27783792145079, 1.27783792145079, 3.01502314975175,3.26996379559728, 4.04761005816072, 3.51851994821143, 2.23993294052725,2.05345237750153, 3.50065703994316, 2.87253114070876, 2.41858148925446,2.24697652608387, 3.93642323495304, 3.39002408954806, 2.03213687526541,1.82454031701715, 3.83351376435236, 3.26996379559728, 2.87936876595197,2.85715172143432, 0.894780929273979, 0, 2.83512487284721, 2.00867331531907,0.912270158508577, 3.39002408954806, 3.83351376435236, 3.16380906859081,3.28790521972423, 2.87253114070876, 3.50065703994316, 2.05345237750153,2.23993294052725, 2.72382053598182, 3.37969863585473, 2.40686957599093,2.56781114321579, 2.00867331531907, 2.83512487284721, 1.82454031701715,2.03213687526541, 2.55567584290157, 2.56781114321579, 2.00867331531907,2.83512487284721, 0, 0.894780929273979, 2.68434278782194, 2.56781114321579,1.82454031701715, 3.28790521972423, 3.16380906859081, 2.41858148925446,2.87253114070876, 2.23993294052725, 2.05345237750153, 2.23993294052725,2.72382053598182, 2.56781114321579, 2.40686957599093, 1.27783792145079,2.00867331531907, 2.03213687526541, 1.82454031701715, 2.03213687526541,2.40686957599093, 1.27783792145079, 2.00867331531907, 0.894780929273979,0, 1.78956185854796, 2.40686957599093, 2.03213687526541, 4.14914256504028,3.63486168486052, 2.41858148925446, 2.24697652608387, 3.37969863585473,2.72382053598182, 2.23993294052725, 2.05345237750153, 3.60537340068437,2.99925870864792, 1.27783792145079, 0.912270158508576, 3.24571156619819,2.55567584290157, 2.03213687526541, 2.99925870864792, 1.27783792145079,0.912270158508577, 2.68434278782194, 1.78956185854796, 0, 2.99925870864792,3.24571156619819, 2.88898718350915, 2.74692810883134, 3.64788037909765,3.96344925467488, 3.28790521972423, 3.16380906859081, 3.28790521972423,3.63486168486052, 0.894780929273979, 0, 2.40029523707353, 2.85715172143432,2.56781114321579, 2.40686957599093, 2.56781114321579, 1.82454031701715,3.01502314975175, 3.39002408954806, 2.56781114321579, 2.40686957599093,2.99925870864792, 0, 2.56781114321579, 4.08259507658297, 4.17949942824879,3.8612601429046, 4.3488497845, 2.74692810883134, 2.88898718350915,3.27843646890669, 3.84074344855516, 2.40686957599093, 2.56781114321579,2.00867331531907, 2.83512487284721, 0, 0.894780929273979, 1.78956185854796,3.6402676830235, 3.26996379559728, 3.83351376435236, 1.82454031701715,2.03213687526541, 3.24571156619819, 2.56781114321579, 0), .Dim = c(23L,23L), .Dimnames = list(c("sp1", "sp2", "sp3", "sp4", "sp5", "sp6","sp7", "sp8", "sp9", "sp10", "sp11", "sp12", "sp13", "sp14","sp15", "sp18", "sp19", "sp20", "sp21", "sp22", "sp24", "sp26","sp29"), c("sp1", "sp2", "sp3", "sp4", "sp5", "sp6", "sp7", "sp8","sp9", "sp10", "sp11", "sp12", "sp13", "sp14", "sp15", "sp18","sp19", "sp20", "sp21", "sp22", "sp24", "sp26", "sp29")))
clearLog()

#Have to convert things to matrices as the 'dist' object inclues the call that produced the object, which causes problems when inputting the dumped data

#Community distance matrix
checkEquals(as.matrix(comm.dist(data)), comm.dist.output)
checkEquals(comm.dist(data), comm.dist(data$comm))
checkEquals(comm.dist(data), comm.dist(as.matrix(data$comm)))
#Trait distance matrix
checkEquals(as.matrix(trait.dist(data)), trait.dist.output)
checkEquals(trait.dist(data), trait.dist(data$traits))
checkEquals(trait.dist(data), trait.dist(as.matrix(data$traits)))

Log()